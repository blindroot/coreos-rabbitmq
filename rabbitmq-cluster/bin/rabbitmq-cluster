require 'rabbitmq/cluster'

server = RabbitMQ::Cluster::Server.new(
  RabbitMQManager.new('http://guest:guest@localhost:15672'),
  RabbitMQ::Cluster::Etcd.new(
    Etcd::Client.new(uri: ENV['ETCD_HOST'])
  )
)

server.start

while true do
  server.synchronize
  sleep 4
end
